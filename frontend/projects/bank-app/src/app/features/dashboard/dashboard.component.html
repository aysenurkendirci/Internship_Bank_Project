<div *ngIf="loading" class="p-6 text-center font-bold text-slate-500">
  Veriler hazÄ±rlanÄ±yor...
</div>

<div *ngIf="error" class="m-4 p-4 rounded-xl bg-red-50 text-red-700 border border-red-100">
  {{ error }}
</div>

<ng-container *ngIf="vm as data">
  <header class="flex justify-between items-center mb-10 px-4 lg:px-0">
    <div>
      <h1 class="text-3xl font-black text-slate-900">
        Selam, {{ data.user.firstName }}! ðŸ‘‹
      </h1>
      <p class="text-slate-400 font-bold">Panelinize tekrar hoÅŸ geldiniz.</p>
    </div>

    <div class="hidden md:flex items-center bg-white px-5 py-2.5 rounded-full border border-slate-100 shadow-sm w-72">
      <span class="material-symbols-outlined text-slate-400 mr-2">search</span>
      <input type="text" placeholder="Ä°ÅŸlem ara..." class="outline-none bg-transparent text-sm font-semibold" />
    </div>
  </header>

  <section class="bg-white p-8 md:p-12 rounded-[48px] shadow-sm border border-slate-50 flex flex-col md:flex-row justify-between items-center mb-12">
    <div>
      <p class="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mb-3">TOPLAM VARLIÄžIM</p>
      <div class="flex items-center gap-4">
        <span class="text-5xl md:text-6xl font-black text-slate-900 tracking-tighter">
          â‚º{{ data.totalWealth | number: '1.2-2' }}
        </span>
        <span class="bg-emerald-50 text-emerald-600 px-3 py-1 rounded-full text-xs font-black border border-emerald-100">
          +{{ (data.wealthChangeRate * 100) | number: '1.1-1' }}%
        </span>
      </div>
    </div>

    <div class="flex gap-4 mt-8 md:mt-0">
      <button class="bg-blue-600 text-white px-10 py-4 rounded-2xl font-black shadow-lg shadow-blue-200 transition-transform active:scale-95">
        + Para YÃ¼kle
      </button>
      <button class="bg-slate-50 text-slate-900 px-10 py-4 rounded-2xl font-black hover:bg-slate-100 transition-colors">
        Para GÃ¶nder
      </button>
    </div>
  </section>

  <div class="mb-12">
    <div class="flex items-center justify-between mb-6 px-2">
      <h3 class="text-xl font-black text-slate-900">KartlarÄ±m</h3>
      <button class="text-blue-600 font-bold text-sm hover:underline">TÃ¼mÃ¼nÃ¼ GÃ¶r</button>
    </div>

    <div class="flex gap-6 overflow-x-auto pb-6 no-scrollbar -mx-4 px-4 lg:mx-0 lg:px-0">
      <div
        *ngFor="let card of data.cards; let i = index"
        [routerLink]="['/dashboard/cards', card.cardId]"
        [ngClass]="cardGradient(i)" 
        class="cursor-pointer min-w-[340px] md:min-w-[400px] h-[230px] rounded-[40px] p-10 text-white flex flex-col justify-between shadow-xl flex-shrink-0 transition-hover"
      >
        <div class="flex justify-between items-start">
          <span class="text-2xl font-black italic tracking-tighter opacity-90">NEO</span>
          <span class="material-symbols-outlined opacity-50">contactless</span>
        </div>

        <div class="text-2xl font-bold tracking-[0.3em] opacity-90">
          **** **** **** {{ card.cardNoMasked.slice(-4) }}
        </div>

        <div class="flex justify-between items-end">
          <div>
            <p class="text-[10px] font-black uppercase opacity-60 mb-1">BAKÄ°YE</p>
            <p class="text-2xl font-black">â‚º{{ card.balance | number: '1.2-2' }}</p>
          </div>
          <span class="px-4 py-1.5 bg-white/10 rounded-full text-[10px] font-black border border-white/20 uppercase">
            {{ card.isVirtual ? 'SANAL' : 'FÄ°ZÄ°KSEL' }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
    
    <div class="lg:col-span-2">
      <div class="flex items-center justify-between mb-6 px-2">
        <h3 class="text-xl font-black text-slate-900">Son Ä°ÅŸlemler</h3>
        <button class="text-blue-600 font-bold text-sm hover:underline">TÃ¼mÃ¼nÃ¼ GÃ¶r</button>
      </div>

      <div class="space-y-4">
        <div *ngFor="let tx of data.recentTransactions" class="flex items-center justify-between p-6 bg-white rounded-[32px] border border-slate-50 shadow-sm transition-hover">
          <div class="flex items-center gap-5">
            <div class="w-14 h-14 rounded-2xl bg-slate-50 flex items-center justify-center text-slate-400">
              <span class="material-symbols-outlined text-2xl">
                {{ tx.direction === 'Inbound' ? 'south_west' : 'north_east' }}
              </span>
            </div>
            <div>
              <p class="text-lg font-black text-slate-900 leading-tight">{{ tx.title }}</p>
              <p class="text-xs text-slate-400 font-bold uppercase tracking-wide">
                {{ tx.category }} â€¢ {{ tx.createdAt | date:'d MMMM, HH:mm' }}
              </p>
            </div>
          </div>
          <div class="text-right">
            <p [ngClass]="tx.direction === 'Inbound' ? 'text-emerald-500' : 'text-slate-900'" class="text-lg font-black tracking-tighter">
              {{ tx.direction === 'Inbound' ? '+' : '-' }}â‚º{{ tx.amount | number:'1.2-2' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="lg:col-span-1">
      <div class="flex items-center justify-between mb-6 px-2">
        <h3 class="text-xl font-black text-slate-900">HesaplarÄ±m</h3>
      </div>
      
      <div class="space-y-4">
        <div 
          *ngFor="let acc of data.accounts" 
          [routerLink]="['/dashboard/accounts', acc.accountId]"
          class="cursor-pointer bg-white p-6 rounded-[32px] border border-slate-50 shadow-sm transition-hover"
        >
          <div class="flex items-center justify-between mb-5">
            <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center">
              <span class="material-symbols-outlined text-xl">
                {{ acc.iconType === 'bank' ? 'account_balance' : (acc.iconType === 'trend' ? 'trending_up' : 'wallet') }}
              </span>
            </div>
            <span *ngIf="acc.subtitle" 
                  [ngClass]="acc.status === 'Aktif' ? 'text-emerald-500 bg-emerald-50' : 'text-slate-400 bg-slate-50'"
                  class="text-[10px] font-black px-2.5 py-1 rounded-full uppercase">
              {{ acc.subtitle }}
            </span>
          </div>
          
          <div>
            <p class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-1">{{ acc.accountName }}</p>
            <p class="text-2xl font-black text-slate-900 tracking-tighter">â‚º{{ acc.balance | number:'1.2-2' }}</p>
            <p class="text-[10px] font-bold text-slate-400 mt-2 opacity-60 tracking-widest">{{ acc.accountNo }}</p>
          </div>
        </div>
      </div>
    </div>

  </div>

</ng-container>